<!DOCTYPE html>
<html>
    <head>
        <title>SP2003 Window</title>
        <link rel="stylesheet" href="styles/style.css">
        <!-- jquery Library -->
        <!--
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        -->
        <script type="text/javascript" src="constants/jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="constants/xlsx.full.min.js"></script>
    </head>

    <body>
        <center>
        <div id="project">Switch/LDO Status</div>
        <!--
        <svg style="background:rgba(0, 255, 255, 0.2); width:100%; height:calc(20vh + 20px); margin:auto; display:block;">
   <text id="title" text-anchor="middle" x="50%" y="20vh">Software</text>
</svg>
        -->
        <form name="area">
            <div id="svgContainer" name="container" align="center"></div>
        </form>
        </center>


		<script language="javascript">
            var CHIPsPerBank;
            var maxDUTs;
            var signalsPerDut;
            var DUTsPerChip;
            const xmlns = "http://www.w3.org/2000/svg";
            const VIN = '2.5V';

            function getUrlParams() {
                var params = {};
                window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) { params[key] = value; });
                return params;
            }

//            var DutInfo;
            var OnOff;
            var Reject;
            var Common;
//            var CLSFlags;
//            var TSD5Flags;
//            var TSD7Flags;
            var AVin;
            var Ldo02Level;
            var Ldo13Level;
            var DutsPerChip;

            var SelectedDut;
            var TargetBank;
            var CHIP;
            var SP2003;


            function NumberToIndicater( num ) {
                /*
                if( num < 353 ) {
                    return ((Math.ceil(num / 8) + 0) + ((((num-1) % 8) + 1) / 10));
                } else if( num < 705 ) {
                    return ((Math.ceil(num / 8) + 20) + ((((num-1) % 8) + 1) / 10));
                } else if( num < 1057 ) {
                    return ((Math.ceil(num / 8) + 40) + ((((num-1) % 8) + 1) / 10));
                } else {
                    return ((Math.ceil(num / 8) + 60) + ((((num-1) % 8) + 1) / 10));
                }
                */
                return ((Math.ceil(num / 8) + (parseInt((num-1) / 352)*20)) + ((((num-1) % 8) + 1) / 10));
            }

            $(document).ready(function(){
                // window width & height.
//                console.log(`Window position : (${window.screenX}, ${window.screenY}), size : ${window.innerWidth} x ${window.innerHeight}`);

                // 부모 윈도우의 요소를 read한다.
//                var site = opener.document.getElementById('siteNumber').value;

                // 부모 윈도우의 변수를 참조한다.
//                maxDUTs = opener.maxDUTs;
//                DutInfo = opener.DutInfo;

                var nGROUP = NaN;
                var nPageCnt;

                var oParams = getUrlParams();
//                console.log(`oParams = ${oParams}, ${JSON.stringify(oParams)}`);
                if( jQuery.isEmptyObject(oParams) ) {
                    if( window.location.protocol === 'file:' ) {
                        SelectedDut = JSON.parse(localStorage.getItem('SelectedDut'));
                        TargetBank = JSON.parse(localStorage.getItem('TargetBank'));    // Chip = {Duts:, SP2003:, number:}
                        AVin = JSON.parse(localStorage.getItem('AVin'));
                    } else {
                        SelectedDut = (opener === null) ? 0 : opener.SelectedDut;
                        TargetBank = (opener === null) ? 0 : opener.TargetBank;
                        AVin = (opener === null) ? 0 : opener.AVin;
                    }
                    // 선택된 Chip의 정보 : iBank, iPage, nChip, nDut[] 
                    // SelectedDut Object
                    // Bank 구성 정보 : AVin, ChipsPerBank, device, maxDUTs, DutsPerChip, BankCnt, ...
                    // Emulator Chip의 상태 : Assign, Group, OnOff, Reject, LDO02Level, LDO13Level, COMMON, ..
                    // Chip Object
                    console.log('Selected Dut : ', SelectedDut);
                    console.log('TargetBank : ', TargetBank);

                    /*
                    CHIP = TargetBank.Pages[SelectedDut.iPage].Chips[SelectedDut.nChip-1];
                    */
                    TargetBank.Pages[SelectedDut.iPage].Chips.some(function(Chip, ChipIdx) {
//                        console.log('chip number : ', Chip.number);
                        if( Chip.number == SelectedDut.nChip) {
                            CHIP = Chip;
                            return true;
                        }
                        return false;
                    });

                    if( CHIP.SP2003.Assign != 0 ) nGROUP = CHIP.SP2003.Assign;
                    OnOff = CHIP.SP2003.OnOff;
                    Reject = CHIP.SP2003.Reject;
                    Common = CHIP.SP2003.COMMON;
                    Ldo02Level = CHIP.SP2003.LDO02Level;
                    Ldo13Level = CHIP.SP2003.LDO13Level;

                } else {
                    iBank = parseInt(oParams.TargetBank);
                    iPage = parseInt(oParams.PAGE);
                    nChip = parseInt(oParams.CHIP);
                    nDut = parseInt(oParams.DUT);
                    AVin = parseFloat(oParams.AVIN);
                    nGROUP = parseInt(oParams.GROUP);

                    SelectedDut.iBank = iBank;
                    SelectedDut.iPage = iPage;
                    SelectedDut.nChip = nChip;
                    SelectedDut.nDut = nDut;

                    OnOff = parseInt(oParams.ONOFF);                  // 현재 PMIC의 상태
                    Reject = parseInt(oParams.REJECT);                  // 현재 PMIC의 상태
                    Common = parseInt(oParams.COMMON);                  // 현재 PMIC의 상태
//                CLSFlags = parseInt(oParams.CLS);
//                TSD5Flags = parseInt(oParams.TSD150);
//                TSD7Flags = parseInt(oParams.TSD170);
                    Ldo02Level = parseInt(oParams.LEVEL0);
                    Ldo13Level = parseInt(oParams.LEVEL1);
                }

//                console.log('SelectedDut : ', SelectedDut);
//                console.log('SP2003 : ', CHIP);
//                console.log(`OnOff = 0x${OnOff.toString(16)}, Reject = 0x${Reject.toString(16)}, Common = ${Common.toString(16)}`);

//                console.log(`AVin = ${AVin}, LDO02Level = ${Ldo02Level}, LDO13Level = 0x${Ldo13Level}`);

                var nCSN = (SelectedDut.iBank * 3) + SelectedDut.iPage;
                createSVG(nGROUP, nCSN);

                // 브라우저의 Window 크기에 맞추어서 svg영역을 재설정한다.
                var w = $(window).width();
                var h = $(window).height();
//                console.log(`window size : (${w} x ${h})`);

                $('#ChipView').width(w-10);
                $('#ChipView').height(h-70);
//                console.log(`inner size : ${$('#ChipView').innerWidth()} x ${$('#ChipView').innerHeight()}`);


                $(`#${SelectedDut.nDut}-DUT`).attr('stroke', (SelectedDut.nDut > 1280) ? 'red' : 'blue').attr('stroke-width', 2);


//                $('.SW').attr('stroke', 'black').attr('stroke-width', 1);
                $('circle.SW').attr('fill', 'transparent').attr('visibility', 'visible');
                $('.EVC').attr('fill', 'transparent');
                $('.VCCQ').attr('fill', 'transparent');

                if( Reject & (1<<5) ) {   // 1'st PMIC SWITCH Reject
                    $('.PMIC1.SW').attr('stroke', 'gray');
                    $('.PMIC1.SW.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<5) ) {       // 1'st PMIC Switch On.
                        $('.PMIC1.SW').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.SW.ON').attr('visibility', 'visible');
                        $('.DUT0.EVC').attr('fill', 'blue');
                        $('.SWLevel0').attr('visibility', 'visible');
                    } else {
                        $('.PMIC1.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC1.SW.ON').attr('visibility', 'hidden');
                    }
                }

                if( Reject & (1<<4) ) {   // 1'st PMIC LDO0 Reject
                    $('.PMIC1.LDO1').attr('stroke', 'gray');
                    $('.PMIC1.LDO1.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<4) ) {       // 1'st PMIC LDO#1 On.
                        $('.PMIC1.LDO1').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.LDO1.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.LDO1.ON').attr('visibility', 'visible');
                        $('.DUT0.VCCQ').attr('fill', 'blue');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.LDOLevel0').attr('visibility', 'visible');
                    } else {
                        $('.PMIC1.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO1.ON').attr('visibility', 'hidden');
                    }
                }

                if( Reject & (1<<3) ) {   // 1'st PMIC LDO1 Reject
                    $('.PMIC1.LDO2').attr('stroke', 'gray');
                    if( OnOff & (1<<4) ) $('.PMIC1.LDO1.LDO2').attr('stroke', 'blue');
                    $('.PMIC1.LDO2.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<3) ) {       // 1'st PMIC LDO#2 On.
                        $('.PMIC1.LDO2').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT1.VCCQ').attr('fill', 'blue');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.LDOLevel1').attr('visibility', 'visible');
                    } else {
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'hidden');
                    }
                }

                if( Reject & (1<<2) ) {   // 2'nd PMIC SWITCH Reject
                    $('.PMIC2.SW').attr('stroke', 'gray');
                    $('.PMIC2.SW.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<2) ) {       // 2'nd PMIC Switch On.
                        $('.PMIC2.SW').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.SW.ON').attr('visibility', 'visible');
                        $('.DUT1.EVC').attr('fill', 'red');
                        $('.SWLevel1').attr('visibility', 'visible');
                    } else {
                        $('.PMIC2.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC2.SW.ON').attr('visibility', 'hidden');
                    }
                }

                if( Reject & (1<<1) ) {   // 2'nd PMIC LDO2 Reject
                    $('.PMIC2.LDO1').attr('stroke', 'gray');
                    $('.PMIC2.LDO1.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<1) ) {       // 2'nd PMIC LDO#1 On.
                        $('.PMIC2.LDO1').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.LDO1.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.LDO1.ON').attr('visibility', 'visible');
                        $('.DUT1.VCCQ').attr('fill', 'red');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.LDOLevel2').attr('visibility', 'visible');
                    } else {
                        $('.PMIC2.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO1.ON').attr('visibility', 'hidden');
                    }
                }

                if( Reject & (1<<0) ) {   // 2'nd PMIC LDO3 Reject
                    $('.PMIC2.LDO2').attr('stroke', 'gray');
                    if( OnOff & (1<<4) ) $('.PMIC2.LDO1.LDO2').attr('stroke', 'red');
                    $('.PMIC2.LDO2.OFF').attr('stroke', 'gray');
                } else {        // reject이 아닌 경우.
                    if( OnOff & (1<<0) ) {       // 2'nd PMIC LDO#2 On.
                        $('.PMIC2.LDO2').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT0.VCCQ').attr('fill', 'red');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.LDOLevel3').attr('visibility', 'visible');
                    } else {
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'hidden');
                    }
                }

//                console.log(`CLS : 0x${Common.toString(16)}`);
                if( Common & (1<<5) ) {       // Clipping Enable.
//                    console.log('clipping enable');
                    $(`#PMIC${SelectedDut.nChip}`).attr('stroke', 'Fuchsia').attr('stroke-width', '3');
                }

                /*
                // SVG영역에서 mouse pointer를 출력한다.
                s1 = document.getElementById('ChipView');
                s1.addEventListener('mousedown', e => {
                    console.log(`(${e.offsetX}, ${e.offsetY}`);
                }, false);
                */

            });

        // 브라우저 windows의 크기를 변경하면 Call된다.
        $(window).resize( function() {
//            console.log(this);
            var w = $(window).width();
            var h = $(window).height();

            $("#ChipView").width(w-10);
            $("#ChipView").height(h-70);

//            console.log(`inner size : ${$('#ChipView').innerWidth()} x ${$('#ChipView').innerHeight()}`);
//            console.log(`rect width = ${$('#Card').width()}`);
        });

            function createSVG(nGROUP, nCSN) {
                // SVG(Scalable Vector Graphics) 영역 생성하기.
                var svgTag = document.createElementNS(xmlns, 'svg');
                var svgWidth = 460+10;
                var svgHeight = 330 + 10;//350;
                $(svgTag).attr({
                    id:'ChipView', align:'center', width:'100%', height:'100%',
                    viewBox:`0 0 ${svgWidth} ${svgHeight}`//, onclick:'showPosition(event)'
                });

//                console.log(`viewBox(${svgTag.getAttribute('viewBox')})`);

                var sx;
                var sy;
                var x;
                var y;
                var w;
                var h;

                sx = 10;
                sy = 30;
                w = 160;    // width : 160
                h = 300;    // height : 320
                l = 100;    // length : 100

                x = sx;
                y = sy;
                // SPI 통신 입력
                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x, y1:y+20, x2:x+l, y2:y+20, class:'greenStroke'
                }).appendTo(svgTag);
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:x+(l>>1), y:y+10, class:'spiText effect'
                }).text(`SPI[${SelectedDut.iBank}]`).appendTo(svgTag);
                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x, y1:y+40, x2:x+l, y2:y+40, stroke:'green', 'stroke-width':1
                }).appendTo(svgTag);
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:x+(l>>1), y:y+35, fill:'green', 'font-size':12, 'font-weight':'bold', class:'centerAlign'
                }).text(`CSN[${nCSN}]`).appendTo(svgTag);

                // SP2003 rect
                x = sx + l + (w >> 1); // 10 + 100 + (160 / 2)
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:x, y:y+20, class:'effect', 'font-size':16, fill:(CHIP.SP2003.Assign == 1)?'blue':'black'
                }).text(`${CHIP.number}-CHIP(${nGROUP})`).appendTo(svgTag);

                x = sx + l;
                $(document.createElementNS(xmlns, 'rect')).attr({
                    x:x, y:y, rx:5, ry:5, width:w, height:h, id:`PMIC${SelectedDut.nChip}`, class:'SP2003'
//                    x:x, y:y, rx:5, ry:5, width:w, height:h, id:`PMIC${SelectedDut.nChip}`, stroke:'black', 'stroke-width':1, fill:'transparent', onclick:'Test()'
                }).appendTo(svgTag);

                // SPI 통신 출력
                x = sx + l + w;
                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x, y1:y+20, x2:x+l, y2:y+20, class:'greenStroke'
                }).appendTo(svgTag);
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:x+(l>>1), y:y+10, class:'spiText effect'
//                    x:x+(l>>1), y:y+10, class:'svgText color2'
                }).text(`SPI[${SelectedDut.iBank}]`).appendTo(svgTag);

                sy = sy + 80;
                h = 100;
                for(var n=0; n<2; n++) {        // PMIC-0, PMIC-1
                    x = sx;                     // 10
                    y = sy + (120 * n);         // 110, 230
                    // PPS input line draw.
                    color = (n == 0) ? 'blue' : 'red';
                    $(document.createElementNS(xmlns, 'line')).attr({
                        x1:x, y1:y, x2:x+120, y2:y, stroke:color, 'stroke-width':2
                    }).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+40, y:y-7, class:'ppsText effect', fill:color
                    }).text(`PPS #${TargetBank.Pages[SelectedDut.iPage].nPPS[n]}`).appendTo(svgTag);

                    // PMIC text & rect draw.
                    x = sx + 100 + 40;
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+40, y:y-26, class:'effect gray'
                    }).text((n==0)?`1'st PMIC`:`2'nd PMIC`).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:x, y:y-20, rx:5, ry:5, width:80, height:100, class:'PMIC'
                    }).appendTo(svgTag);

                    // 각 요소의 stroke, stroke-width, visibility, fill 옵션이 변경된다.
                    // PMIC switch draw.
                    // PMIC LDO1 draw.
                    // PMIC LDO2 draw.
                    x = sx + l + (w>>1);
                    y = sy + (120 * n);         // sy + (dy * n);
//                    console.log(`n = ${n}, x = ${x}, y = ${y}`);
                    for(var i=0; i<3; i++) {
//                        console.log(`1. sx = ${sx}, sy = ${sy}, x = ${x}, y = ${y}`);
                        // x = 190, y = 110/110/140/230/230/260
                        if( i == 0 ) {          // Switch draw.
                            // 1'st PMIC switch. -> (190, 120)
                            // switch input line
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x-60, y1:y, x2:x-23, y2:y, class:`PMIC${n+1} SW`, stroke:color
                            }).appendTo(svgTag);
                            // switch output line.
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x+23, y1:y, x2:x+180, y2:y, class:`PMIC${n+1} SW`, stroke:'black'
                            }).appendTo(svgTag);
                            $(document.createElementNS(xmlns, 'circle')).attr({
                                cx:x-20, cy:y, r:3, class:`PMIC${n+1} SW`, stroke:'black', fill:'transparent'
                            }).appendTo(svgTag);
                            $(document.createElementNS(xmlns, 'circle')).attr({
                                cx:x+20, cy:y, r:3, class:`PMIC${n+1} SW`, stroke:'black', fill:'transparent'
                            }).appendTo(svgTag);
                            // switch OFF line.
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x-17, y1:y, x2:x+20, y2:y-10, class:`PMIC${n+1} SW OFF`, stroke:'black'
                            }).appendTo(svgTag);
                            // switch ON line
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x-17, y1:y, x2:x+17, y2:y, class:`PMIC${n+1} SW ON`, stroke:'black'
                            }).appendTo(svgTag);
                        } else {                // LDO1/2 draw.
                            // LDO1 -> (190, 120+30)
                            // LDO2 -> (190, 120+30+30)
                            y = y + 30;
                            //// 1.
                            // 1'st PMIC SW 연결점.
                            $(document.createElementNS(xmlns, 'circle')).attr({
                                cx:x-60, cy:y-30, r:3, stroke:'black', fill:'black'
                            }).appendTo(svgTag);
                            /// PMIC LDO0/1 input line.
                            $(document.createElementNS(xmlns, "path")).attr({
                                d:`M ${x-60} ${y-30} v 30 h 37`, class:`PMIC${n+1} LDO${i}`, stroke:color, 'stroke-width':1, fill:'transparent'
                            }).appendTo(svgTag);

                            // LDO1 Out line.
                            if( n == 0 ) {          // PMIC-0
                                // internal short case : 70, 60
                                $(document.createElementNS(xmlns, 'line')).attr({
                                    id:`line${n}${i}`, class:`PMIC${n+1} LDO${i}`,
                                    x1:x+23, y1:y, x2:x+(180 - (40*i)), y2:y, stroke:'black', 'stroke-width':1, opacity:1
                                }).appendTo(svgTag);
                                if( i == 2 ) {
                                    // internal short case.
                                    // 1'st LDO1 Aout 연결.
                                    $(document.createElementNS(xmlns, 'circle')).attr({
                                        cx:x+100, cy:y+90, r:3, id:`circle${n}${i}`, stroke:'black', fill:'black'
                                    }).appendTo(svgTag);

                                    // PMIC2 LDO Out2 연결선.
                                    $(document.createElementNS(xmlns, 'line')).attr({
                                        id:`line1${n}${i}`, class:`PMIC${n+1} LDO${i}`,
                                        x1:x+100, y1:y, x2:x+100, y2:y+90, stroke:'black', 'stroke-width':1, opacity:1
                                    }).appendTo(svgTag);
                                }
                            } else {                // PMIC-1
                                // internal short case : 60, 70
                                $(document.createElementNS(xmlns, 'line')).attr({
                                    id:`line${n}${i}`, class:`PMIC${n+1} LDO${i}`,
                                    x1:x+23, y1:y, x2:x+(60 + (40*i)), y2:y, stroke:'black', 'stroke-width':1, opacity:1
                                }).appendTo(svgTag);
                                if( i == 2 ) {
                                    // internal short case.
                                    // 1'st LDO1 Aout 연결.
                                    $(document.createElementNS(xmlns, 'circle')).attr({
                                        cx:x+140, cy:y-150, r:3, id:`circle${n}${i}`, stroke:'black', fill:'black'
                                    }).appendTo(svgTag);
                                    // PMIC2 LDO Out2 연결선.
                                    $(document.createElementNS(xmlns, 'line')).attr({
                                        id:`line1${n}${i}`, class:`PMIC${n+1} LDO${i}`,
                                        x1:x+140, y1:y, x2:x+140, y2:y-150, stroke:'black', 'stroke-width':1, opacity:1
                                    }).appendTo(svgTag);
                                }
                            }

                            $(document.createElementNS(xmlns, 'circle')).attr({
                                cx:x-20, cy:y, r:3, class:`PMIC${n+1} LDO${i}`, stroke:'black', fill:'transparent'//, visibility:'visible'
                            }).appendTo(svgTag);
                            $(document.createElementNS(xmlns, 'circle')).attr({
                                cx:x+20, cy:y, r:3, class:`PMIC${n+1} LDO${i}`, stroke:'black', fill:'transparent'//, visibility:'visible'
                            }).appendTo(svgTag);
                            $(document.createElementNS(xmlns, "path")).attr({
                                d:`M ${x} ${y-15} v 7 m ${-17} 0 h 34`, class:`PMIC${n+1} LDO${i} OFF`, stroke:'black', 'stroke-width':1, fill:'transparent'
                            }).appendTo(svgTag);
                            $(document.createElementNS(xmlns, "path")).attr({
                                d:`M ${x} ${y-8} v 8 m ${-17} 0 h 34`, class:`PMIC${n+1} LDO${i} ON`, stroke:color, 'stroke-width':1, fill:'transparent'
                            }).appendTo(svgTag);
                        }
                    }

                    // Channel Name Text Create.
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y-53, class:'channelText'
                    }).text(`SW${n}`).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y-23, class:'channelText'
                    }).text(`LDO${n*2}`).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+7, class:'channelText'
                    }).text(`LDO${(n*2)+1}`).appendTo(svgTag);

                    // SW0/1, LDO0/1/2/3 Level Text Create.
                    x = sx + 100 + w;
                    y = sy + (120 * n);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x-20, y:y-7, class:`centerText SWLevel${n}`, fill:color//, visibility:'visible'
                    }).text(`${(AVin/1000).toFixed(2)}V`).appendTo(svgTag);
                    // LDO0/2 Level Text Create.
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x-20, y:y+30-7, id:'ldoLevel', class:`centerText LDOLevel${(n*2)}`, fill:color//, visibility:'visible'
                    }).text(`${(Ldo02Level/1000).toFixed(2)}V`).appendTo(svgTag);
                    // LDO1/3 Level Text Create.
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x-20, y:y+60-7, id:'ldoLevel', class:`centerText LDOLevel${(n*2)+1}`, fill:color//, visibility:'visible'
                    }).text(`${(Ldo13Level/1000).toFixed(2)}V`).appendTo(svgTag);

                    // DUT draw.
                    x = x + 100;        // 10(sx) + 100 + 160(w) + 100;
                    y = y - 40;
//                    console.log(`4. sx = ${sx}, sy = ${sy}, x = ${x}, y = ${y}`);
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        id:`${CHIP.Duts[n]}-DUT`, x:x, y:y, rx:5, ry:5, width:80, height:100, class:'DUT',
                        stroke:'black', 'stroke-width':2
                    }).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+40, y:y+10, class:'dutText effect'
                    }).text(`${NumberToIndicater(CHIP.Duts[n])} DUT`).appendTo(svgTag);

                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:x, y:y+30, width:20, height:20, rx:5, ry:5, class:`DUT${n} EVC`, fill:'transparent'
                    }).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+40, y:y+42, class:'centerText'
                    }).text('EVC').appendTo(svgTag);

                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:x, y:y+60, width:20, height:20, rx:5, ry:5, class:`DUT${n} VCCQ`, fill:'transparent'
                    }).appendTo(svgTag);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+40, y:y+72, class:'centerText'
                    }).text('VccQ').appendTo(svgTag);

                    $(document.createElementNS(xmlns, 'line')).attr({
                        id:`line2${n}`, class:`DUT${n} VCCQ LINE`,
                        x1:x-(40+(n*40)), y1:y+70, x2:x, y2:y+70, stroke:'black', 'stroke-width':1, opacity:1, visibility:'visibility'
                    }).appendTo(svgTag);

//                    console.log(`5. sx = ${sx}, sy = ${sy}, x = ${x}, y = ${y}`);
                }

                document.getElementById('svgContainer').appendChild(svgTag);
            }


            $(document).on('click', '#FPGAChip', function(e) {
                console.log(`type = ${e.type}, target value = ${e.target.value}, ${$(this).data('val')}\n`);
                $('.BankLine').css('visibility', 'visible');
            });

            function showPosition(event) {
//                var x = event.clientX - 20;
//                var y = event.clientY - 114;
//                console.log(`X coords: ${x}, Y coords: ${y}`);
            }

            /*
            var ReducePin = false;
            function Test() {
//                var x2;
                ReducePin = !ReducePin;
//                console.log(`ReducePin : ${ReducePin}`);
                for(var n=0; n<2; n++) {
                    x = 190;
                    y = 120 * (n + 1);
                    for(var i=0; i<3; i++) {
                        if( i == 0 ) continue;
                        if( n == 0 ) {
                            $(`#line${n}${i}`).attr('x2', ReducePin ? x+(80-(10*i)) : x+(180-(40*i)));
                            if( i == 2 ) {
                                $(`#circle${n}${i}`).attr('cx', ReducePin ? x+60 : x+100);
                                $(`#line1${n}${i}`).attr('x1', ReducePin ? x+60 : x+100).attr('x2', ReducePin ? x+60 : x+100);
                            }
                        } else {
                            $(`#line${n}${i}`).attr('x2', ReducePin ? x+(50+(10*i)) : x+(60+(40*i)));
                            if( i == 2 ) {
                                $(`#circle${n}${i}`).attr('cx', ReducePin ? x+70 : x+140);
                                $(`#line1${n}${i}`).attr('x1', ReducePin ? x+70 : x+140).attr('x2', ReducePin ? x+70 : x+140);
                            }
                        }
                    }
                    x = 370;
                    $(`#line2${n}`).attr('x1', ReducePin ? x-(110+(n*10)) : x-(40+(n*40)));
//                    x2 = $(`#line2${n}`).attr('x1');
//                    console.log(`line2[${n}] x1 = ${x2}`);
                }
            }
            */

            function OnOff(chkbox) {
                console.log(`run OnOff() : ${chkbox.value}`);
                var select = parseInt(chkbox.value);
                if( select == 0 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC1.SW').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.SW.ON').attr('visibility', 'visible');
                        $('.DUT0.EVC').attr('fill', 'blue');
                    } else {
                        $('.PMIC1.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC1.SW.ON').attr('visibility', 'hidden');
                        $('.DUT0.EVC').attr('fill', 'transparent');
                    }
                } else if( select == 1 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC1.LDO1').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.LDO1.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.LDO1.ON').attr('visibility', 'visible');
                        $('.DUT0.VCCQ').attr('fill', 'blue');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                    } else {
                        $('.PMIC1.LDO1').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO1.ON').attr('visibility', 'hidden');
                        $('.DUT0.VCCQ').attr('fill', 'transparent');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                } else if( select == 2 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC1.LDO2').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT1.VCCQ').attr('fill', 'blue');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                    } else {
                        $('.PMIC1.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'hidden');
                        $('.DUT1.VCCQ').attr('fill', 'transparent');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                } else if( select == 3 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC2.SW').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.SW.ON').attr('visibility', 'visible');
                        $('.DUT1.EVC').attr('fill', 'red');
                        $('.DUT1.EVC.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                    } else {
                        $('.PMIC2.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC2.SW.ON').attr('visibility', 'hidden');
                        $('.DUT1.EVC').attr('fill', 'transparent');
                        $('.DUT1.EVC.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                } else if( select == 4 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC2.LDO1').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.LDO1.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.LDO1.ON').attr('visibility', 'visible');
                        $('.DUT1.VCCQ').attr('fill', 'red');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'red').attr('stroke-width', 3);
                    } else {
                        $('.PMIC2.LDO1').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO1.ON').attr('visibility', 'hidden');
                        $('.DUT1.VCCQ').attr('fill', 'transparent');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                } else if( select == 5 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC2.LDO2').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT0.VCCQ').attr('fill', 'red');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'red').attr('stroke-width', 3);
                    } else {
                        $('.PMIC2.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'hidden');
                        $('.DUT0.VCCQ').attr('fill', 'transparent');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                } else if( select == 6 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC1.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'hidden');
                        $('.DUT1.VCCQ').attr('fill', 'transparent');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC2.SW.ON').attr('visibility', 'hidden');
                        $('.DUT1.EVC').attr('fill', 'transparent');

                        $('.PMIC2.LDO2').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT0.VCCQ').attr('fill', 'red');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC1.SW').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.SW.ON').attr('visibility', 'visible');
                        $('.DUT0.EVC').attr('fill', 'blue');
                    }
                } else if( select == 7 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC2.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'hidden');
                        $('.DUT0.VCCQ').attr('fill', 'transparent');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC1.SW.ON').attr('visibility', 'hidden');

                        $('.DUT0.EVC').attr('fill', 'transparent');
                        $('.PMIC1.LDO2').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'hidden');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'visible');
                        $('.DUT1.VCCQ').attr('fill', 'blue');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'blue').attr('stroke-width', 3);
                        $('.PMIC2.SW').attr('stroke', 'red').attr('stroke-width', 3);
                        $('.PMIC2.SW.OFF').attr('visibility', 'hidden');
                        $('.PMIC2.SW.ON').attr('visibility', 'visible');
                        $('.DUT1.EVC').attr('fill', 'red');
                    }
                } else if( select == 8 ) {
                    if( chkbox.checked == true ) {
                        $('.PMIC1.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC1.SW.ON').attr('visibility', 'hidden');
                        $('.PMIC1.LDO1').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO1.ON').attr('visibility', 'hidden');
                        $('.PMIC1.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC1.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC1.LDO2.ON').attr('visibility', 'hidden');
                        $('.PMIC2.SW').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.SW.OFF').attr('visibility', 'visible');
                        $('.PMIC2.SW.ON').attr('visibility', 'hidden');
                        $('.PMIC2.LDO1').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.LDO1.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO1.ON').attr('visibility', 'hidden');
                        $('.PMIC2.LDO2').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.PMIC2.LDO2.OFF').attr('visibility', 'visible');
                        $('.PMIC2.LDO2.ON').attr('visibility', 'hidden');

                        $('.DUT0.EVC').attr('fill', 'transparent');
                        $('.DUT0.VCCQ').attr('fill', 'transparent');
                        $('.DUT0.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                        $('.DUT1.EVC').attr('fill', 'transparent');
                        $('.DUT1.VCCQ').attr('fill', 'transparent');
                        $('.DUT1.VCCQ.LINE').attr('stroke', 'black').attr('stroke-width', 1);
                    }
                }
            }

/*
            var SwitchMapWindow;
            $(window).on('beforeunload', function() {
                if( (SwitchMapWindow != undefined) || (SwitchMapWindow != NaN) )
                    SwitchMapWindow.close();
                console.log('beforeunload');
                alert('lkkk');
            });
*/
        </script>
    </body>
</html>


